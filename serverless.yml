frameworkVersion: "3"
service: lambda

plugins:
    - serverless-offline
    - serverless-s3-local

package:
    exclude:
        - .git
        - .gitignore
        - .serverless**
        - events/*.json
        - README.md
  
provider:
    name: aws
    runtime: nodejs16.x
    timeout: 200
    environment:
        bucket: ${env:bucket}
        accessKeyId: ${env:accessKeyId}
        secretAccessKey: ${env:secretAccessKey}
        TWILIO_ACCOUNT_SID: ${env:TWILIO_ACCOUNT_SID}
        TWILIO_AUTH_TOKEN: ${env:TWILIO_AUTH_TOKEN}

custom:
    serverless-offline:
        port: 3003
        host: 0.0.0.0
        resourceRoutes: true
    s3:
        host: localhost
        port: 3003
        directory: /tmp/s3

resources:
  Resources:
    NewResource:
      Type: AWS::S3::Bucket
      Properties:
        BucketName: local-bucket
        
functions:
  getYoutubeVideo:
    handler: app.handler
    timeout: 200
    events:
      - httpApi:
          path: /
          method: get
  postYoutubeVideo:
    handler: app.handler
    timeout: 200
    events:
      - httpApi:
          path: /
          method: post
  s3hook:
    handler: app.s3hook
    events:
      - s3: local-bucket
        event: s3:*